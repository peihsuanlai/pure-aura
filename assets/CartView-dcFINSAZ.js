import{a as f}from"./axios-L6U4YIEh.js";import{s as b,S as B,a as M}from"./alertHelper-rCyq43OB.js";import{_ as z,a as H,m as G,r as x,o as u,c,b as e,f as q,j as V,n as m,F as L,h as J,g as $,t as i,e as v,k as j,l as K,p as F,d as a,w as Q,i as W}from"./index-Sm7Rgr_h.js";import{c as O}from"./cartStore-_3CP3fMU.js";var X={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"product-api",BASE_URL:"/pure-aura/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:g,VITE_API_PATH:h}=X,Y={data(){return{loadingStatus:{loadingItem:""},useCoupon:null,couponCode:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{changeNum(l,t){this.loadingStatus.loadingItem=l.id;const d=this.cart.carts.find(o=>o.id===l.id);if(!d)return;t==="minus"?d.qty-=1:t==="plus"&&(d.qty+=1);const _={product_id:l.product_id,qty:d.qty};f.put(`${g}/api/${h}/cart/${l.id}`,{data:_}).then(()=>{this.loadingStatus.loadingItem="",this.getCart()}).catch(()=>{b()})},deleteProduct(l){B.fire({title:"確定刪除此商品？",showCancelButton:!0,confirmButtonText:"是，刪除",cancelButtonText:"取消",icon:"warning"}).then(t=>{t.isConfirmed&&f.delete(`${g}/api/${h}/cart/${l}`).then(()=>{this.getCart()}).catch(()=>{b()})})},applyCoupon(){const t={code:this.couponCode.trim()};f.post(`${g}/api/${h}/coupon`,{data:t}).then(()=>{M("優惠券已套用",!1),this.getCart()}).catch(()=>{b("無此優惠券",!1)})},emptyCart(){B.fire({title:"確定刪除購物車內所有商品？",showCancelButton:!0,confirmButtonText:"是，刪除",cancelButtonText:"取消",icon:"warning"}).then(l=>{l.isConfirmed&&f.delete(`${g}/api/${h}/carts`).then(()=>{this.getCart(),this.$router.push("/products")}).catch(()=>{b()})})},sendOrder(){const l=`${g}/api/${h}/order`,t=this.form;f.post(l,{data:t}).then(d=>{this.$refs.form.resetForm(),this.$router.push(`/checkout/${d.data.orderId}`)}).catch(()=>{b()})},isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"請輸入正確的電話號碼"},...H(O,["getCart"])},computed:{discount(){return this.cart.total-this.cart.final_total},...G(O,["cart","isLoading"])},mounted(){this.getCart()}},Z={class:"cart-page no-banner"},tt={class:"container-lg"},et={class:"d-flex justify-content-between align-items-center",style:{"margin-bottom":"1.5rem"}},st={"data-th":"圖片"},lt=["textContent"],ot=["textContent"],nt={"data-th":"數量"},at={class:"number-box"},rt=["onClick","disabled"],it=["textContent"],dt=["onClick","disabled"],ut={"data-th":"總價"},ct=["textContent"],mt={key:0},pt=["textContent"],ft={"data-th":"刪除"},bt=["onClick"],vt={key:0,class:"total-summary mb-5 reveal"},gt={class:"text-end fw-bold"},ht=["textContent"],Ct={class:"d-flex justify-content-between fw-bold"},yt=["textContent"],xt={class:"form-check"},Vt={class:"input-group mb-3 input-group-sm"},_t={class:"form-check"},kt={class:"d-flex justify-content-between border-bottom pb-3 mb-3 fw-bold"},wt=["textContent"],Tt={class:"d-flex justify-content-between fw-bold"},St=["textContent"],It={class:"mt-5 reveal"},Nt={class:"col-lg-5 mb-3"},Et={class:"col-lg-5 mb-3"},Pt={class:"col-lg-5 mb-3"},Ut={class:"col-lg-5 mb-3"},At={class:"col-lg-10 mb-5"},Bt={class:"text-center"},qt=["disabled"];function Lt(l,t,d,_,o,n){var k,w,T,S,I,N,E,P,U;const C=x("VeeField"),y=x("ErrorMessage"),R=x("VeeForm"),D=x("LoadingOverlay");return u(),c(L,null,[e("main",Z,[e("div",tt,[t[29]||(t[29]=q('<nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/">首頁</a></li><li class="breadcrumb-item active" aria-current="page">購物車</li></ol></nav>',1)),t[30]||(t[30]=e("h2",{claas:"reveal","data-origin":"top"},"購物車",-1)),t[31]||(t[31]=q('<div class="row justify-content-center mb-5 reveal" data-origin="top"><div class="col-lg-7"><div class="row step-list"><div class="col active"><div class="item"><div class="step active d-flex flex-column align-items-center"><span>STEP</span><span>1</span></div><h5>確認訂單</h5></div></div><div class="col"><div class="item"><div class="step d-flex flex-column align-items-center"><span>STEP</span><span>2</span></div><h5>結帳付款</h5></div></div><div class="col"><div class="item"><div class="step d-flex flex-column align-items-center"><span>STEP</span><span>3</span></div><h5>訂單完成</h5></div></div></div></div></div>',1)),e("div",et,[t[11]||(t[11]=e("h3",{class:"reveal mb-0"},"確認訂購品項",-1)),((w=(k=l.cart)==null?void 0:k.carts)==null?void 0:w.length)>0?(u(),c("button",{key:0,type:"button",class:"remove-btn",onClick:t[0]||(t[0]=(...s)=>n.emptyCart&&n.emptyCart(...s))},"清空購物車")):V("",!0)]),e("table",{class:m(["cart-table reveal",{"mb-4":((S=(T=l.cart)==null?void 0:T.carts)==null?void 0:S.length)===0}])},[t[16]||(t[16]=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"品項"),e("th",null,"單價"),e("th",null,"數量"),e("th",null,"總價"),e("th",null,"刪除")])],-1)),e("tbody",null,[((I=l.cart.carts)==null?void 0:I.length)>0?(u(!0),c(L,{key:0},J(l.cart.carts,s=>(u(),c("tr",{key:s.id},[e("td",st,[e("div",{class:"img",style:W({backgroundImage:`url(${s.product.imageUrl})`})},null,4)]),e("td",{"data-th":"品項",textContent:i(s.product.title)},null,8,lt),e("td",{"data-th":"單價",textContent:i("NT$"+l.$filter.currency(s.product.price))},null,8,ot),e("td",nt,[e("div",at,[e("button",{type:"button",onClick:p=>n.changeNum(s,"minus"),disabled:o.loadingStatus.loadingItem===s.id||s.qty===1},t[12]||(t[12]=[e("i",{class:"bi bi-dash-lg"},null,-1)]),8,rt),e("span",{textContent:i(s.qty)},null,8,it),e("button",{type:"button",onClick:p=>n.changeNum(s,"plus"),disabled:o.loadingStatus.loadingItem===s.id},t[13]||(t[13]=[e("i",{class:"bi bi-plus-lg"},null,-1)]),8,dt)])]),e("td",ut,[e("div",{textContent:i("NT$"+l.$filter.currency(s.total)),class:m({"text-decoration-line-through":s.final_total!==s.total})},null,10,ct),s.final_total!==s.total?(u(),c("div",mt,[t[14]||(t[14]=e("span",null,"折扣後：",-1)),e("span",{textContent:i("NT$"+l.$filter.currency(s.final_total))},null,8,pt)])):V("",!0)]),e("td",ft,[e("button",{type:"button",class:"remove-btn",onClick:p=>n.deleteProduct(s.id)},t[15]||(t[15]=[e("i",{class:"bi bi-trash3"},null,-1)]),8,bt)])]))),128)):V("",!0)])],2),((E=(N=l.cart)==null?void 0:N.carts)==null?void 0:E.length)>0?(u(),c("div",vt,[e("div",null,[e("div",gt,[t[17]||(t[17]=$("共計 ")),e("span",{textContent:i((U=(P=l.cart)==null?void 0:P.carts)==null?void 0:U.length)},null,8,ht),t[18]||(t[18]=$(" 項商品"))]),e("div",Ct,[t[19]||(t[19]=e("span",null,"商品小計",-1)),e("span",{textContent:i("NT$"+l.$filter.currency(l.cart.total))},null,8,yt)]),e("div",xt,[v(e("input",{class:"form-check-input",type:"radio",id:"radio1",value:"1","onUpdate:modelValue":t[1]||(t[1]=s=>o.useCoupon=s)},null,512),[[j,o.useCoupon]]),t[20]||(t[20]=e("label",{class:"form-check-label",for:"radio1"}," 使用優惠折扣碼 ",-1))]),v(e("div",Vt,[v(e("input",{type:"text",class:"form-control",placeholder:"請輸入折扣碼","onUpdate:modelValue":t[2]||(t[2]=s=>o.couponCode=s)},null,512),[[F,o.couponCode]]),e("button",{type:"button",class:"btn btn-primary text-white",onClick:t[3]||(t[3]=(...s)=>n.applyCoupon&&n.applyCoupon(...s))}," 套用折扣碼 ")],512),[[K,o.useCoupon==1]]),e("div",_t,[v(e("input",{class:"form-check-input",type:"radio",id:"radio2",value:"0","onUpdate:modelValue":t[4]||(t[4]=s=>o.useCoupon=s)},null,512),[[j,o.useCoupon]]),t[21]||(t[21]=e("label",{class:"form-check-label",for:"radio2"}," 取消任何折扣 ",-1))]),e("div",kt,[t[22]||(t[22]=e("span",null,"折扣",-1)),e("span",{textContent:i("-NT$"+l.$filter.currency(n.discount))},null,8,wt)]),e("div",Tt,[t[23]||(t[23]=e("span",null,"應付總額",-1)),e("span",{textContent:i("NT$"+l.$filter.currency(l.cart.final_total))},null,8,St)])])])):V("",!0),t[32]||(t[32]=e("h3",{class:"reveal"},"填寫訂購資料",-1)),e("div",It,[a(R,{ref:"form",class:"row justify-content-center",onSubmit:n.sendOrder},{default:Q(({errors:s})=>{var p,A;return[e("div",Nt,[t[24]||(t[24]=e("label",{for:"name",class:"form-label"},"姓名",-1)),a(C,{id:"name",name:"姓名",type:"text",class:m(["form-control",{"is-invalid":s.姓名}]),rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":t[5]||(t[5]=r=>o.form.user.name=r)},null,8,["class","modelValue"]),a(y,{name:"姓名",class:"invalid-feedback"})]),e("div",Et,[t[25]||(t[25]=e("label",{for:"email",class:"form-label"},"信箱",-1)),a(C,{id:"email",name:"信箱",type:"email",class:m(["form-control",{"is-invalid":s.信箱}]),rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":t[6]||(t[6]=r=>o.form.user.email=r)},null,8,["class","modelValue"]),a(y,{name:"信箱",class:"invalid-feedback"})]),e("div",Pt,[t[26]||(t[26]=e("label",{for:"tel",class:"form-label"},"電話",-1)),a(C,{id:"tel",name:"電話",type:"tel",class:m(["form-control",{"is-invalid":s.電話}]),rules:n.isPhone,modelValue:o.form.user.tel,"onUpdate:modelValue":t[7]||(t[7]=r=>o.form.user.tel=r)},null,8,["rules","class","modelValue"]),a(y,{name:"電話",class:"invalid-feedback"})]),e("div",Ut,[t[27]||(t[27]=e("label",{for:"address",class:"form-label"},"地址",-1)),a(C,{id:"address",name:"地址",type:"text",class:m(["form-control",{"is-invalid":s.地址}]),rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":t[8]||(t[8]=r=>o.form.user.address=r)},null,8,["class","modelValue"]),a(y,{name:"地址",class:"invalid-feedback"})]),e("div",At,[t[28]||(t[28]=e("label",{for:"message",class:"form-label"},"備註",-1)),v(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[9]||(t[9]=r=>o.form.message=r)},null,512),[[F,o.form.message]])]),e("div",Bt,[e("button",{type:"submit",class:"cta-btn",disabled:((A=(p=l.cart)==null?void 0:p.carts)==null?void 0:A.length)===0},"確認",8,qt)])]}),_:1},8,["onSubmit"])])])]),a(D,{active:l.isLoading,"onUpdate:active":t[10]||(t[10]=s=>l.isLoading=s)},null,8,["active"])],64)}const Rt=z(Y,[["render",Lt]]);export{Rt as default};
