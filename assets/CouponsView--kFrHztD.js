import{a as C}from"./axios-L6U4YIEh.js";import{s as P,a as I,D as T}from"./DeleteModal-DmLaehKG.js";import{M as k}from"./bootstrap.esm-jT_nS5sZ.js";import{_ as v,o as i,c as d,b as t,e as p,p as r,v as D,r as c,F as h,h as V,d as m,t as _}from"./index-DnPImcva.js";import{P as A}from"./PaginationComponent-D-UOqYr5.js";var E={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"product-api",BASE_URL:"/pure-aura/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:b,VITE_API_PATH:f}=E,U={props:{coupon:{type:Object,default:()=>({})},isNew:{type:Boolean}},data(){return{couponModal:null,tempCoupon:{},due_date:""}},watch:{coupon(){this.tempCoupon=this.coupon;const n=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");this.due_date=n[0]},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{updateData(){let n=`${b}/api/${f}/admin/coupon/${this.coupon.id}`,o="put";this.isNew&&(n=`${b}/api/${f}/admin/coupon`,o="post"),C[o](n,{data:this.tempCoupon}).then(()=>{this.$emit("update"),P()}).catch(u=>{I(u)}),this.closeModal()},openModal(){this.couponModal.show()},closeModal(){this.couponModal.hide()}},mounted(){this.couponModal=new k(this.$refs.couponModal),this.tempCoupon=this.coupon}},L={class:"modal fade",id:"couponModal",ref:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},$={class:"modal-dialog",role:"document"},S={class:"modal-content"},R={class:"modal-header bg-dark text-white"},O={class:"modal-title",id:"exampleModalLabel"},N={key:0},B={key:1},H={class:"modal-body"},F={class:"mb-3"},j={class:"mb-3"},q={class:"mb-3"},z={class:"mb-3"},G={class:"mb-3"},J={class:"form-check"},K={class:"modal-footer"};function Q(n,o,u,g,e,a){return i(),d("div",L,[t("div",$,[t("div",S,[t("div",R,[t("h5",O,[u.isNew?(i(),d("span",N,"新增優惠券")):(i(),d("span",B,"編輯優惠券"))]),o[6]||(o[6]=t("button",{type:"button",class:"btn text-white","data-bs-dismiss":"modal","aria-label":"Close"},[t("i",{class:"bi bi-x-lg"})],-1))]),t("div",H,[t("div",F,[o[7]||(o[7]=t("label",{for:"title"},"標題",-1)),p(t("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=s=>e.tempCoupon.title=s)},null,512),[[r,e.tempCoupon.title]])]),t("div",j,[o[8]||(o[8]=t("label",{for:"coupon_code"},"優惠碼",-1)),p(t("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[1]||(o[1]=s=>e.tempCoupon.code=s)},null,512),[[r,e.tempCoupon.code]])]),t("div",q,[o[9]||(o[9]=t("label",{for:"due_date"},"到期日",-1)),p(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=s=>e.due_date=s)},null,512),[[r,e.due_date]])]),t("div",z,[o[10]||(o[10]=t("label",{for:"price"},"折扣百分比",-1)),p(t("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入折扣百分比","onUpdate:modelValue":o[3]||(o[3]=s=>e.tempCoupon.percent=s)},null,512),[[r,e.tempCoupon.percent]])]),t("div",G,[t("div",J,[p(t("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":o[4]||(o[4]=s=>e.tempCoupon.is_enabled=s)},null,512),[[D,e.tempCoupon.is_enabled]]),o[11]||(o[11]=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])]),t("div",K,[o[12]||(o[12]=t("button",{type:"button",class:"btn btn-light","data-bs-dismiss":"modal"},"取消",-1)),t("button",{type:"button",class:"btn btn-primary text-white",onClick:o[5]||(o[5]=(...s)=>a.updateData&&a.updateData(...s))},"確認")])])])],512)}const W=v(U,[["render",Q]]);var X={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"product-api",BASE_URL:"/pure-aura/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:Y,VITE_API_PATH:Z}=X,tt={data(){return{type:"coupon",coupons:[],pagination:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:null,isLoading:!0}},components:{DeleteModal:T,CouponModal:W,PaginationComponent:A},methods:{getCoupons(n=1){C.get(`${Y}/api/${Z}/admin/coupons?page=${n}`).then(o=>{this.isLoading=!1,this.coupons=o.data.coupons,this.pagination=o.data.pagination})},openModal(n,o){n==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.modalCoupon.openModal()):n==="edit"?(this.tempCoupon={...o},this.isNew=!1,this.$refs.modalCoupon.openModal()):n==="delete"&&(this.tempCoupon={...o},this.$refs.modalDelete.openModal())}},mounted(){this.getCoupons()}},ot={class:"container"},et={class:"text-end mt-4"},nt={class:"table mt-4"},st=["textContent"],lt=["textContent"],at=["textContent"],it={key:0,class:"text-success"},dt={key:1},pt={class:"btn-group"},ut=["onClick"],rt=["onClick"];function ct(n,o,u,g,e,a){const s=c("PaginationComponent"),M=c("LoadingOverlay"),y=c("DeleteModal"),x=c("CouponModal");return i(),d(h,null,[t("div",ot,[t("div",et,[t("button",{class:"btn btn-primary text-white",onClick:o[0]||(o[0]=l=>a.openModal("new"))}," 建立新的優惠券 ")]),t("table",nt,[o[2]||(o[2]=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1)),t("tbody",null,[(i(!0),d(h,null,V(e.coupons,l=>(i(),d("tr",{key:l.key},[t("td",{textContent:_(l.title)},null,8,st),t("td",{textContent:_(l.percent)},null,8,lt),t("td",{textContent:_(n.$filter.date(l.due_date))},null,8,at),t("td",null,[l.is_enabled?(i(),d("span",it,"啟用")):(i(),d("span",dt,"未啟用"))]),t("td",null,[t("div",pt,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:w=>a.openModal("edit",l)},"編輯",8,ut),t("button",{class:"btn btn-outline-danger btn-sm",onClick:w=>a.openModal("delete",l)},"刪除",8,rt)])])]))),128))])]),m(s,{pages:e.pagination,onSwitchPage:n.getOrders},null,8,["pages","onSwitchPage"])]),m(M,{active:e.isLoading,"onUpdate:active":o[1]||(o[1]=l=>e.isLoading=l)},null,8,["active"]),m(y,{ref:"modalDelete",item:e.tempCoupon,onUpdate:a.getCoupons,type:e.type},null,8,["item","onUpdate","type"]),m(x,{ref:"modalCoupon",coupon:e.tempCoupon,"is-new":e.isNew,onUpdate:a.getCoupons},null,8,["coupon","is-new","onUpdate"])],64)}const Ct=v(tt,[["render",ct]]);export{Ct as default};
